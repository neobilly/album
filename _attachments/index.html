<!DOCTYPE html>
<html>
  <head>
    <title>Example CouchApp</title>
    <link rel="stylesheet" href="style/main.css" type="text/css">
      <link rel="stylesheet" href="style/jquery.mobile.structure-1.1.1.css" type="text/css"> 
      <link rel="stylesheet" href="style/jquery.mobile.structure-1.1.1.min.css" type="text/css">
      <link rel="stylesheet" href="style/jquery.mobile.theme-1.1.1.css" type="text/css">
      <link rel="stylesheet" href="style/jquery.mobile.theme-1.1.1.min.css" type="text/css">
      <link rel="stylesheet" href="style/jquery.mobile-1.1.1.min.css" type="text/css">
  </head>
  <body>
    <div data-role="page">
          <div data-role="header"><h2>Albums</h2></div>
          <div data-role="content">
              <ul id="albums" data-role="listview" data-theme="c" data-dividertheme="b" />
          </div>
          <div data-role="footer">Footer</div>
    </div>
    <div data-role="page" id="albumview">
        <div data-role="header" id="albumheader">
            <h2 class="albumtitle"></h2>
        </div>
        <div data-role="content" id="albumcontent"></div>
        <div data-role="footer" />
    </div>
   <!--<div id="account"></div>

    <h1>Example CouchApp</h1>

    <div id="profile">
    </div>
    <div id="content"></div>

    <div id="sidebar">
      <p>Edit welcome message.</p>
      <p>Ideas: You could easily turn this into a photo sharing app, 
          or a grocery list, or a chat room. <a href="https://github.com/couchapp/example">Code for this app is on Github.</a></p>
    </div>
 --></body>
  <script src="/_utils/script/sha1.js"></script>
  <script src="/_utils/script/json2.js"></script>
  <script src="/_utils/script/jquery.js"></script>
  <script src="/_utils/script/jquery.couch.js"></script>
  <script src="vendor/couchapp/jquery.couchLogin.js"></script>
  <script src="vendor/couchapp/jquery.couchProfile.js"></script>
  <script src="vendor/couchapp/md5.js"></script>
  <script src="vendor/couchapp/jquery.mustache.js"></script>
  <script src="vendor/couchapp/jquery.mobile-1.1.1.js"></script>
  <script src="vendor/couchapp/jquery.evently.js"></script> 
  <script type="text/javascript" charset="utf-8">
 
      var albumId;

      $db = $.couch.db("albums"); //declare an instance of the database
 
      function handleDocumentReady()
      {
          $("#albumview").bind( "pagebeforeshow", openAlbum ); //we have bound the “pagebeforeshow” event to the openAlbum() method handler within the handleDocumentReader() method. This will invoke openAlbum() prior to transitioning to the albumview page, allowing us to request the document based on the albumId and add elements to the content of the albumview page:
          refreshAlbums();
      }
 
      function refreshAlbums()
      {
          $("#albums").empty();
          $db.view("albums/album",
            { success: function( data ) {
                    var i;
                    var album;
                    var artist;
                    var title;
                    var description;
                    var listItem;
                    var genre;
                    for( i in data.rows )
                    {
                        album = data.rows[i].value;
                        artist = album.artist;
                        title = album.title;
                        description = album.description;
                        genre = album.genre;
                        listItem = $("<li/>", {
                                            class: "album"
                                        });
                        header = "<h2 class=\"artist\">" + artist + "<\/h2>";
                        albumLink = $("<a/>", {
                                                href: "#albumview",
                                                "data-identity": album._id,
                                                click: function() {
                                                    albumId = $(this).data("identity");
                                                }
                                        });
                        albumLink.append( header );
                        listItem.append( albumLink );
                        listItem.append( "<p class=\"title\">" + title + "<\/p>" );
                        listItem.append( "<p class=\"description\">" + description + "<\/p>" );
                        listItem.append( "<p class=\"genre\">" + genre + "<\/p>" );
                        $("#albums").append( listItem );
                    }
                    $("#albums").listview( "refresh" );
                }
            });
      }

    function openAlbum()
      {
          $("#albumcontent").children().remove();
            $db.openDoc( albumId,
                  { success: function( data ) {
                          var artist = data.artist;
                          var title = data.title;
                          var description = data.description;
                          var genre = data.genre;
                          var html = "<h2 class=\"artist\">" + artist + "<\/h2>" +
                                        "<p class=\"title\">" + title + "<\/p>" +
                                        "<p class=\"description\">" + description + "<\/p>" +
                                        "<p class=\"genre\">" + genre + "<\/p>";
                          $("#albumcontent").append( html );
                          $("#albumheader .albumtitle").text( title );
                  }
              });
      }
      $(document).ready( handleDocumentReady );
  </script>

<!-- templates used by app.js -->
  <script id="new-message" type="text/x-mustache" charset="utf-8">
      <div class="avatar">
        {{#gravatar_url}}<img src="{{gravatar_url}}"/>{{/gravatar_url}}
        <div class="name">
          {{name}}
        </div>
      </div>
      <form id="create-message">
        <label>New message from {{nickname}}: <input type="text" name="message" size=60 value=""></label>
      </form>
      <div style="clear:left;"></div>
  </script>

  <script id="recent-messages" type="text/x-mustache" charset="utf-8">
        <h3>Recent Messages</h3>
        <ul id="items">
          {{#items}}
            <li>
              <div class="avatar">
                {{#gravatar_url}}<img src="{{gravatar_url}}" alt="{{name}}"/>{{/gravatar_url}}
                <div class="name">
                  {{nickname}}
                </div>
              </div>
              <p>{{message}}</p>
              <div style="clear:left;"></div>
            </li>
          {{/items}}
        </ul>
        <p><em>Protip:</em> If you setup continuous replication between this database and a remote one, this list will reflect remote changes in near real-time.</p>
        <p>This would be a good place to add pagination.</p>
  </script>
  <script src="script/app.js"></script>

</html>
